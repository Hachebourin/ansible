---
dependency:
  name: galaxy
  options:
    role-file: ${MOLECULE_PROJECT_DIRECTORY}/molecule/resources/requirements/requirements.yml

driver:
  name: docker

lint:
  name: yamllint

platforms:
  - name: centos-7-kafka
    image: "centos:7"
    disable_cache: true
    privileged: true
    volume_mounts:
      - "/sys/fs/cgroup:/sys/fs/cgroup:rw"
    command: "/usr/sbin/init"
    dockerfile: ../resources/dockerfiles/Dockerfile-systemd.j2

provisioner:
  name: ansible
  lint:
    name: ansible-lint
  playbooks:
    converge: ../resources/playbooks/playbook-create_topic.yml
  env:
    ANSIBLE_LIBRARY: ${ANSIBLE_LIBRARY}:${MOLECULE_PROJECT_DIRECTORY}/

scenario:
  name: create_topic
  test_sequence:
    - dependency
    - lint
    - syntax
    - create
    - prepare
    - converge
    # - idempotence
    - verify
    - destroy

verifier:
  name: testinfra
  directory: ../resources/tests/commun

  options:
    sudo: true
    verbose: true
    s: true
  lint:
    name: flake8
